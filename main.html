<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ProActive safety - MVP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
    body { font-family: 'Tajawal', sans-serif; background-color: #f0f2f5; }
    .card-height { height: 450px; } 
    .custom-scroll::-webkit-scrollbar { width: 4px; }
    .custom-scroll::-webkit-scrollbar-thumb { background: #6366f1; border-radius: 10px; }
    @keyframes pulse-red {
      0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
      100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
    }
    .status-alert { animation: pulse-red 2s infinite; }
  </style>
</head>
<body class="p-4">

<header class="bg-[#111827] text-white p-4 rounded-xl mb-6 shadow-lg flex justify-between items-center border-b-2 border-indigo-500">
    <h1 class="text-xl font-bold italic text-indigo-400 font-mono tracking-wider">ğŸ›¡ï¸ ProActive safety - MVP</h1>
    <div class="text-[10px] text-red-400 font-bold uppercase animate-pulse">Ø±ØµØ¯ Ù…Ø¨Ø§Ø´Ø±: Ø§Ù„Ù†Ø¸Ø§Ù… Ù†Ø´Ø·</div>
</header>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

  <div class="bg-white rounded-2xl shadow-sm border border-gray-200 flex flex-col card-height overflow-hidden">
    <div class="p-4 bg-red-50 border-b border-red-100"><h2 class="font-bold text-red-700">âš ï¸ Ø¹Ù…Ø§Ù„ ÙÙŠ Ø®Ø·Ø±</h2></div>
    <div class="flex-1 overflow-y-auto custom-scroll">
        <table class="w-full text-[11px] text-center">
            <thead class="bg-gray-50 sticky top-0 border-b z-10 font-bold text-gray-600">
                <tr>
                    <th class="p-3">ID</th>
                    <th class="p-3 text-right">Ø§Ù„Ø§Ø³Ù…</th>
                    <th class="p-3">Ù†ÙˆØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</th>
                    <th class="p-3">Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                    <th class="p-3">Ø§Ù„ÙˆÙ‚Øª</th>
                    <th class="p-3">Ø§Ù„ØªØ­Ù„ÙŠÙ„</th>
                </tr>
            </thead>
            <tbody id="workersList" class="divide-y divide-gray-50"></tbody>
        </table>
    </div>
  </div>

  <div class="bg-white rounded-2xl shadow-sm border border-gray-200 flex flex-col card-height overflow-hidden">
    <div class="p-4 bg-blue-50 border-b border-blue-100"><h2 class="font-bold text-blue-700">ğŸ“ Ù…Ù†Ø§Ø·Ù‚ ÙÙŠ Ø®Ø·Ø±</h2></div>
    <div class="flex-1 overflow-y-auto custom-scroll">
        <table class="w-full text-[11px] text-center">
            <thead class="bg-gray-50 sticky top-0 border-b z-10 font-bold text-gray-600">
                <tr>
                    <th class="p-3">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
                    <th class="p-3">Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø°ÙŠØ±</th>
                    <th class="p-3">Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø±</th>
                    <th class="p-3">Ø§Ù„Ø¹Ù…Ø§Ù„</th>
                    <th class="p-3">ØªØ­Ù„ÙŠÙ„</th>
                </tr>
            </thead>
            <tbody id="zonesDangerList" class="divide-y divide-gray-50"></tbody>
        </table>
    </div>
  </div>

  <div class="bg-white rounded-2xl shadow-sm border border-gray-200 flex flex-col card-height overflow-hidden">
    <div class="p-4 bg-indigo-50 border-b border-indigo-100"><h2 class="font-bold text-indigo-700">ğŸ‘¥ Ø§Ù„Ø·ÙˆØ§Ù‚Ù… Ø§Ù„Ø¥Ø´Ø±Ø§ÙÙŠØ©</h2></div>
    <div class="flex-1 overflow-y-auto custom-scroll p-4 grid grid-cols-1 gap-3" id="supervisorsList"></div>
  </div>

  <div class="bg-white rounded-2xl shadow-sm border border-gray-200 flex flex-col card-height overflow-hidden">
    <div class="p-4 bg-emerald-50 border-b border-emerald-100"><h2 class="font-bold text-emerald-700">âš™ï¸ Ø´Ø¨ÙƒØ© IOT</h2></div>
    <div class="flex-1 overflow-y-auto custom-scroll p-4 space-y-2" id="sensorsStatusList"></div>
  </div>

</div>

<div id="modalWorker" class="hidden fixed inset-0 bg-black/90 backdrop-blur-md flex items-center justify-center z-50 p-4">
    <div class="bg-white w-full max-w-5xl rounded-3xl overflow-hidden shadow-2xl flex flex-col md:flex-row border-t-8 border-indigo-600">
        <div class="p-8 flex-1 text-right border-l overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-start border-b pb-4 mb-6">
                <div><h3 id="det-name" class="text-2xl font-black text-gray-800">--</h3><p class="text-indigo-600 font-bold text-sm" id="det-id">--</p></div>
                <div class="bg-red-600 text-white px-4 py-1 rounded-full text-xs font-bold animate-pulse" id="det-trigger">--</div>
            </div>
            <div class="grid grid-cols-2 gap-6 mb-8 border-b pb-6">
                <div><label class="text-[10px] text-gray-400 block uppercase">Ø§Ù„Ø¹Ù…Ø±</label><p id="det-age" class="font-bold">--</p></div>
                <div><label class="text-[10px] text-gray-400 block uppercase">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label><p id="det-loc" class="font-bold text-indigo-600">--</p></div>
                <div><label class="text-[10px] text-gray-400 block uppercase">Ø§Ù„Ù…Ø´Ø±Ù</label><p id="det-sup" class="font-bold">--</p></div>
                <div><label class="text-[10px] text-gray-400 block uppercase">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ©</label><p id="det-history" class="font-bold text-red-500 bg-red-50 px-2 rounded">--</p></div>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-gray-50 p-4 rounded-2xl border text-center"><span class="text-[9px] text-gray-400 block font-bold">PULSE</span><span id="vital-heart" class="text-4xl font-black text-red-600">--</span></div>
                <div class="bg-gray-50 p-4 rounded-2xl border text-center"><span class="text-[9px] text-gray-400 block font-bold">TEMP</span><span id="vital-temp" class="text-4xl font-black text-orange-500">--</span></div>
                <div class="bg-gray-50 p-4 rounded-2xl border text-center"><span class="text-[9px] text-gray-400 block font-bold">OXYGEN</span><span id="vital-ox" class="text-4xl font-black text-blue-600">--</span></div>
                <div class="bg-gray-50 p-4 rounded-2xl border text-center"><span class="text-[9px] text-gray-400 block font-bold">PRESSURE</span><span id="vital-bp" class="text-3xl font-black text-indigo-800">--</span></div>
            </div>
            <div class="mt-8 flex gap-2"><button onclick="confirmAction()" class="flex-1 bg-black text-white font-bold py-4 rounded-xl hover:bg-indigo-600 transition-all">Ø¥Ø±Ø³Ø§Ù„ ÙØ±ÙŠÙ‚ Ø§Ø³ØªØ¬Ø§Ø¨Ø©</button><button onclick="closeWorkerModal()" class="px-8 py-4 bg-gray-100 rounded-xl font-bold">Ø±Ø¬ÙˆØ¹</button></div>
        </div>
        <div class="bg-[#050505] flex-1 p-6 flex flex-col items-center justify-center relative min-h-[350px]">
            <div id="map-pointer" class="w-12 h-12 rounded-full border-4 border-white shadow-[0_0_50px_#ef4444]"></div>
        </div>
    </div>
</div>

<div id="modalZone" class="hidden fixed inset-0 bg-black/90 backdrop-blur-md flex items-center justify-center z-50 p-4">
    <div class="bg-white w-full max-w-2xl rounded-3xl overflow-hidden shadow-2xl border-t-8 border-blue-600 p-8 text-right">
        <h3 id="zone-title" class="text-2xl font-black text-gray-800 mb-2">--</h3>
        <p class="text-blue-600 font-bold mb-6" id="zone-sup">Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: --</p>
        <div class="bg-blue-50 p-6 rounded-2xl mb-6">
            <div class="flex justify-between items-center mb-4">
                <span class="font-bold text-gray-600">Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø± ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹:</span>
                <span id="zone-risk-pct" class="text-2xl font-black text-red-600">--%</span>
            </div>
            <div class="w-full bg-gray-200 h-3 rounded-full overflow-hidden">
                <div id="zone-risk-bar" class="bg-red-600 h-full transition-all duration-1000"></div>
            </div>
        </div>
        <h4 class="font-bold text-gray-700 mb-3 border-b pb-2">Ø§Ù„Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹:</h4>
        <div id="zone-workers-list" class="space-y-2 max-h-40 overflow-y-auto custom-scroll mb-8"></div>
        <button onclick="closeZoneModal()" class="w-full py-4 bg-gray-100 rounded-xl font-bold text-gray-600 hover:bg-gray-200 transition-all">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    </div>
</div>

<script>
let workers = [
  { id: 1, no: "W-101", name: "Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ", age: 34, history: "Ø¶ØºØ· Ø¯Ù… Ù…Ø±ØªÙØ¹", sup: "Ù…. Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ", trigger: "Ù‡Ø¨ÙˆØ· Ø­Ø§Ø¯ Ø¨Ø§Ù„Ø¶ØºØ·", severity: "critical", statusText: "Ø®Ø·Ø± Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹", location: "Zone A", time: "11:20" },
  { id: 2, no: "W-102", name: "John Smith", age: 29, history: "Ù„Ø§ ÙŠÙˆØ¬Ø¯", sup: "Ù…. Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ", trigger: "Ø§Ù†Ø®ÙØ§Ø¶ Ø£ÙƒØ³Ø¬ÙŠÙ† Ø­Ø§Ø¯", severity: "critical", statusText: "Ø®Ø·Ø± Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹", location: "Zone B", time: "11:22" },
  { id: 3, no: "W-103", name: "Ø®Ø§Ù„Ø¯ Ø§Ù„Ø³Ø§Ù„Ù…", age: 41, history: "Ø³ÙƒØ±ÙŠ Ù†ÙˆØ¹ 2", sup: "Ù…. ÙÙŠØµÙ„ Ø§Ù„Ø¹Ù„ÙŠ", trigger: "Ø³Ù‚ÙˆØ· Ø­Ø± (IMPACT)", severity: "critical", statusText: "Ø®Ø·Ø± Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹", location: "Zone C", time: "11:25" },
  { id: 4, no: "W-104", name: "Robert Wilson", age: 38, history: "Ø±Ø¨Ùˆ Ù…Ø²Ù…Ù†", sup: "Ù…. ÙÙ‡Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ", trigger: "Ø§Ø±ØªÙØ§Ø¹ Ø­Ø±Ø§Ø±Ø© Ù…ÙØ§Ø¬Ø¦", severity: "critical", statusText: "Ø®Ø·Ø± Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹", location: "Zone D", time: "11:28" },
  { id: 5, no: "W-105", name: "Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ø­Ø±Ø¨ÙŠ", age: 45, history: "Ø¶ØºØ· Ø¯Ù… Ù…Ø±ØªÙØ¹", sup: "Ù…. ÙÙŠØµÙ„ Ø§Ù„Ø¹Ù„ÙŠ", trigger: "Ø§Ø¶Ø·Ø±Ø§Ø¨ Ù†Ø¨Ø¶ Ø§Ù„Ù‚Ù„Ø¨", severity: "critical", statusText: "Ø®Ø·Ø± Ù…Ø±ØªÙØ¹ Ø¬Ø¯Ø§Ù‹", location: "Zone E", time: "11:30" },
  { id: 6, no: "W-106", name: "ÙÙ‡Ø¯ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ", age: 32, history: "Ù„Ø§ ÙŠÙˆØ¬Ø¯", sup: "Ù…. Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ", trigger: "ØªØ³Ø§Ø±Ø¹ Ù†Ø¨Ø¶", severity: "warning", statusText: "Ø®Ø·Ø± Ù…ØªÙˆØ³Ø·", location: "Zone A", time: "11:32" },
  { id: 7, no: "W-107", name: "Michael Brown", age: 27, history: "Ù„Ø§ ÙŠÙˆØ¬Ø¯", sup: "Ù…. Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ", trigger: "Ø¥Ø±Ù‡Ø§Ù‚ Ø¨Ø¯Ù†ÙŠ", severity: "warning", statusText: "Ø®Ø·Ø± Ù…ØªÙˆØ³Ø·", location: "Zone B", time: "11:35" },
  { id: 8, no: "W-108", name: "ÙŠØ§Ø³Ø± Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ", age: 39, history: "Ø³ÙƒØ±ÙŠ Ù†ÙˆØ¹ 1", sup: "Ù…. ÙÙŠØµÙ„ Ø§Ù„Ø¹Ù„ÙŠ", trigger: "Ø§Ø±ØªÙØ§Ø¹ Ø¶ØºØ· Ø§Ù„Ø¯Ù…", severity: "warning", statusText: "Ø®Ø·Ø± Ù…ØªÙˆØ³Ø·", location: "Zone C", time: "11:38" },
  { id: 9, no: "W-109", name: "David Miller", age: 33, history: "Ù„Ø§ ÙŠÙˆØ¬Ø¯", sup: "Ù…. ÙÙ‡Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ", trigger: "Ø§Ù†Ø®ÙØ§Ø¶ Ø£ÙƒØ³Ø¬ÙŠÙ† Ø¨Ø³ÙŠØ·", severity: "warning", statusText: "Ø®Ø·Ø± Ù…ØªÙˆØ³Ø·", location: "Zone D", time: "11:40" },
  { id: 10, no: "W-110", name: "ØªØ±ÙƒÙŠ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ", age: 36, history: "Ù„Ø§ ÙŠÙˆØ¬Ø¯", sup: "Ù…. ÙÙŠØµÙ„ Ø§Ù„Ø¹Ù„ÙŠ", trigger: "ØªØ¬Ø§ÙˆØ² Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø¬Ù„Ø¯", severity: "warning", statusText: "Ø®Ø·Ø± Ù…ØªÙˆØ³Ø·", location: "Zone E", time: "11:42" },
  { id: 11, no: "W-111", name: "Ø³Ø¹Ø¯ Ø§Ù„Ø±Ø§Ø´Ø¯", age: 42, history: "Ø¶ØºØ· Ø¯Ù…", sup: "Ù…. Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ", trigger: "ØªØ°Ø¨Ø°Ø¨ Ø¨Ø³ÙŠØ· Ø¨Ø§Ù„Ù†Ø¨Ø¶", severity: "normal", statusText: "Ù…Ø³ØªÙ‚Ø±", location: "Zone A", time: "11:45" },
  { id: 12, no: "W-112", name: "James Taylor", age: 30, history: "Ù„Ø§ ÙŠÙˆØ¬Ø¯", sup: "Ù…. Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ", trigger: "Ø­Ø±ÙƒØ© Ø¨Ø·ÙŠØ¦Ø©", severity: "normal", statusText: "Ù…Ø³ØªÙ‚Ø±", location: "Zone B", time: "11:48" },
  { id: 13, no: "W-113", name: "Ø¨Ù†Ø¯Ø± Ø§Ù„ÙØ§ÙŠØ²", age: 31, history: "Ù„Ø§ ÙŠÙˆØ¬Ø¯", sup: "Ù…. ÙÙŠØµÙ„ Ø§Ù„Ø¹Ù„ÙŠ", trigger: "ØµØ¯Ø§Ø¹ Ø·ÙÙŠÙ", severity: "normal", statusText: "Ù…Ø³ØªÙ‚Ø±", location: "Zone C", time: "11:50" },
  { id: 14, no: "W-114", name: "Thomas Moore", age: 28, history: "Ù„Ø§ ÙŠÙˆØ¬Ø¯", sup: "Ù…. ÙÙ‡Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ", trigger: "ØªÙ†Ø¨ÙŠÙ‡ ÙŠØ¯ÙˆÙŠ", severity: "normal", statusText: "Ù…Ø³ØªÙ‚Ø±", location: "Zone D", time: "11:52" },
  { id: 15, no: "W-115", name: "Ù†Ø§ÙŠÙ Ø§Ù„Ù…Ø·ÙŠØ±ÙŠ", age: 40, history: "Ø³ÙƒØ±ÙŠ", sup: "Ù…. ÙÙŠØµÙ„ Ø§Ù„Ø¹Ù„ÙŠ", trigger: "Ø·Ù„Ø¨ Ù…ØªØ§Ø¨Ø¹Ø©", severity: "normal", statusText: "Ù…Ø³ØªÙ‚Ø±", location: "Zone E", time: "11:55" }
];

let zonesDanger = [
    { name: "Zone A", trigger: "Ø§Ù‡ØªØ²Ø§Ø² Ø¹Ø§Ù„ÙŠ", severity: "critical", statusText: "Ø®Ø·Ø± Ù…Ø±ØªÙØ¹", workers: 12, sup: "Ù…. Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ", risk: 85 },
    { name: "Zone B", trigger: "Ø§Ù†Ø¨Ø¹Ø§Ø« ØºØ§Ø² CO2", severity: "critical", statusText: "Ø®Ø·Ø± Ù…Ø±ØªÙØ¹", workers: 8, sup: "Ù…. Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ", risk: 92 },
    { name: "Zone C", trigger: "Ø²ÙŠØ§Ø¯Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø±Ùƒ", severity: "warning", statusText: "Ø®Ø·Ø± Ù…ØªÙˆØ³Ø·", workers: 15, sup: "Ù…. ÙÙŠØµÙ„ Ø§Ù„Ø¹Ù„ÙŠ", risk: 64 },
    { name: "Zone D", trigger: "ØªØ°Ø¨Ø°Ø¨ Ø·Ø§Ù‚Ø©", severity: "warning", statusText: "Ø®Ø·Ø± Ù…ØªÙˆØ³Ø·", workers: 5, sup: "Ù…. ÙÙ‡Ø¯ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ", risk: 45 },
    { name: "Zone E", trigger: "ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ©", severity: "normal", statusText: "Ù…Ø³ØªÙ‚Ø±", workers: 20, sup: "Ù…. ÙÙŠØµÙ„ Ø§Ù„Ø¹Ù„ÙŠ", risk: 10 }
];

function refreshWorkers() {
    const list = document.getElementById("workersList");
    list.innerHTML = workers.map(w => {
        let color = w.severity === 'critical' ? 'bg-red-600 animate-pulse' : (w.severity === 'warning' ? 'bg-orange-500' : 'bg-green-500');
        return `<tr class="border-b"><td class="p-3 font-mono text-gray-400 text-[9px]">${w.no}</td><td class="p-3 font-bold text-gray-800 text-right">${w.name}</td><td class="p-3"><div class="text-red-600 font-bold text-[9px]">${w.trigger}</div><div class="${color} text-white text-[7px] px-1 rounded inline-block font-bold">${w.statusText}</div></td><td class="p-3 font-bold text-indigo-500 text-[9px]">${w.location}</td><td class="p-3 font-mono text-gray-400 text-[9px]">${w.time}</td><td class="p-3"><button onclick="openWorkerModal(${w.id})" class="bg-indigo-600 text-white px-3 py-1 rounded text-[9px] font-bold">ØªØ­Ù„ÙŠÙ„</button></td></tr>`;
    }).join('');
}

function refreshZones() {
    const list = document.getElementById("zonesDangerList");
    list.innerHTML = zonesDanger.map((z, idx) => {
        let color = z.severity === 'critical' ? 'bg-red-600' : (z.severity === 'warning' ? 'bg-orange-500' : 'bg-green-500');
        return `<tr class="border-b"><td class="p-3 font-bold text-gray-800">${z.name}</td><td class="p-3 text-red-600 font-bold">${z.trigger}</td><td class="p-3"><span class="${color} text-white text-[7px] px-2 py-0.5 rounded font-bold">${z.statusText}</span></td><td class="p-3 font-bold text-gray-500">${z.workers}</td><td class="p-3"><button onclick="openZoneModal(${idx})" class="bg-blue-600 text-white px-3 py-1 rounded text-[9px] font-bold">Ø¹Ø±Ø¶</button></td></tr>`;
    }).join('');
}

let liveInt = null, activeWorker = null;

function openWorkerModal(id) {
    activeWorker = workers.find(x => x.id === id);
    document.getElementById("det-name").textContent = activeWorker.name;
    document.getElementById("det-id").textContent = "UID: " + activeWorker.no;
    document.getElementById("det-trigger").textContent = activeWorker.trigger;
    document.getElementById("det-age").textContent = activeWorker.age + " Ø³Ù†Ø©";
    document.getElementById("det-loc").textContent = activeWorker.location;
    document.getElementById("det-sup").textContent = activeWorker.sup;
    document.getElementById("det-history").textContent = activeWorker.history;
    clearInterval(liveInt);
    updateStream();
    liveInt = setInterval(updateStream, 2000);
    document.getElementById("modalWorker").classList.remove("hidden");
}

function updateStream() {
    const w = activeWorker;
    let hr, temp, ox, bp;
    if (w.trigger.includes("Ø³Ù‚ÙˆØ·")) { hr = rand(140, 165); temp = randF(36.6, 37.0); ox = rand(88, 92); bp = "150/95"; }
    else if (w.trigger.includes("Ø£ÙƒØ³Ø¬ÙŠÙ†")) { hr = rand(110, 130); temp = randF(36.5, 36.9); ox = rand(78, 84); bp = "110/70"; }
    else if (w.trigger.includes("Ù‡Ø¨ÙˆØ·")) { hr = rand(55, 65); temp = randF(35.9, 36.4); ox = rand(94, 96); bp = `${rand(80,90)}/${rand(50,60)}`; }
    else if (w.trigger.includes("Ø­Ø±Ø§Ø±Ø©")) { hr = rand(100, 120); temp = randF(39.5, 41.2); ox = rand(95, 98); bp = "135/85"; }
    else { hr = rand(72, 85); temp = randF(36.6, 37.2); ox = rand(97, 99); bp = "120/80"; }
    document.getElementById("vital-heart").textContent = hr;
    document.getElementById("vital-temp").textContent = temp;
    document.getElementById("vital-ox").textContent = ox;
    document.getElementById("vital-bp").textContent = bp;
    document.getElementById("map-pointer").className = `w-12 h-12 rounded-full border-4 border-white shadow-2xl transition-all ${w.severity==='critical'?'bg-red-600 status-alert':'bg-indigo-600'}`;
}

function openZoneModal(idx) {
    const z = zonesDanger[idx];
    document.getElementById("zone-title").textContent = "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: " + z.name;
    document.getElementById("zone-sup").textContent = "Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: " + z.sup;
    document.getElementById("zone-risk-pct").textContent = z.risk + "%";
    document.getElementById("zone-risk-bar").style.width = z.risk + "%";
    const onsite = workers.filter(w => w.location === z.name).map(w => w.name);
    document.getElementById("zone-workers-list").innerHTML = onsite.length > 0 ? onsite.map(name => `<div class="bg-gray-50 p-2 rounded text-xs border-r-4 border-blue-400 font-bold">${name}</div>`).join('') : `<p class="text-[10px] text-gray-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù…Ø§Ù„ ÙÙŠ Ø­Ø§Ù„Ø© Ø®Ø·Ø± Ø­Ø§Ù„ÙŠØ§Ù‹</p>`;
    document.getElementById("modalZone").classList.remove("hidden");
}

function closeWorkerModal() { clearInterval(liveInt); document.getElementById("modalWorker").classList.add("hidden"); }
function closeZoneModal() { document.getElementById("modalZone").classList.add("hidden"); }
function confirmAction() { workers = workers.filter(w => w.id !== activeWorker.id); refreshWorkers(); closeWorkerModal(); }

function refreshDashboard() {
    const zones = ["Zone A", "Zone B", "Zone C", "Zone D", "Zone E"];
    document.getElementById("supervisorsList").innerHTML = zones.slice(0,4).map(z => `<div class="p-3 bg-indigo-50 rounded-xl border text-xs flex justify-between"><b>Ù…. ${z === 'Zone A' ? 'Ø£Ø­Ù…Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ' : (z === 'Zone B' ? 'Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ' : 'ÙÙŠØµÙ„ Ø§Ù„Ø¹Ù„ÙŠ')}</b> <span class="text-indigo-400 font-bold text-[9px] uppercase">${z}</span></div>`).join('');
    document.getElementById("sensorsStatusList").innerHTML = zones.map(z => `<div class="p-3 bg-emerald-50 rounded-xl border text-[10px] flex justify-between"><b>${z} - Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª</b> <span>ACTIVE</span></div>`).join('');
}

function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
function randF(min, max) { return (Math.random() * (max - min) + min).toFixed(1); }

refreshWorkers();
refreshZones();
refreshDashboard();
</script>
</body>
</html>