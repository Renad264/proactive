<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>ProActive safety - System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
  
  /* ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ Ø±Ù‚ÙŠÙ‚ Ø¬Ø¯Ø§Ù‹ ÙŠØ´Ù…Ù„ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ ÙˆØ£Ù„ÙˆØ§Ù† Ø§Ù„Ø¨Ø§Ù„ÙŠØª */
  body { 
    font-family: 'Tajawal', sans-serif; 
    background: linear-gradient(135deg, 
        rgba(230, 230, 230, 0.4) 0%, 
        rgba(104, 66, 226, 0.05) 25%, 
        rgba(40, 231, 196, 0.05) 50%, 
        rgba(255, 165, 0, 0.05) 75%, /* Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø¨Ù†Ø³Ø¨Ø© Ø®ÙÙŠÙØ© Ø¬Ø¯Ø§Ù‹ */
        rgba(230, 230, 230, 0.4) 100%
    );
    background-attachment: fixed;
    min-height: 100vh;
  }

  .card-height { height: 450px; }
  .custom-scroll::-webkit-scrollbar { width: 4px; }
  .custom-scroll::-webkit-scrollbar-thumb { background: #6842E2; border-radius: 10px; }
  #sketch-map { width: 100%; height: 200px; background: #e9e9e9; border: 2px solid #999; position: relative; margin-top: 10px; }
  .zone-box { position: absolute; border: 2px dashed #444; font-size: 10px; font-weight: bold; color: #333; text-align: center; padding-top: 3px; }
  #ZoneA { top: 10px; left: 10px; width: 30%; height: 40%; }
  #ZoneB { top: 10px; left: 40%; width: 30%; height: 40%; }
  #ZoneC { top: 10px; left: 70%; width: 28%; height: 40%; }
  #ZoneD { top: 55%; left: 10px; width: 30%; height: 40%; }
  #ZoneE { top: 55%; left: 40%; width: 30%; height: 40%; }
  .worker-dot { width: 14px; height: 14px; background: #f00; border-radius: 50%; position: absolute; transition: all 0.8s ease; }
  
  /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ù…ÙƒØ¨Ù‘Ø± */
  .custom-purple-header { 
    background-color: #6842E2; 
    height: 120px; 
    overflow: hidden;
  }
  .logo-container { 
    height: 100%; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
  }
  .logo-container img { 
    height: 100%; 
    width: auto;
    object-fit: contain; 
    padding: 10px 0;
    transform: scale(1.3);
  }
</style>
</head>
<body class="p-4">

<header class="custom-purple-header text-white px-8 rounded-xl mb-6 shadow-lg flex justify-between items-center relative border-b-4 border-[#28E7C4]">
  <div class="w-1/4"></div>
  <div class="absolute inset-y-0 left-1/2 transform -translate-x-1/2 logo-container">
    <img src="proactivewhite.png" alt="ProActive Safety Logo">
  </div>
  <div class="w-1/4 text-left">
    <p class="text-[10px] sm:text-[12px] font-bold bg-black/20 px-3 py-1 rounded-full border border-white/20 inline-block">
      âš ï¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªØ­Øª Ø§Ù„ØªØ·ÙˆÙŠØ±
    </p>
  </div>
</header>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

  <div class="bg-white rounded-2xl shadow-sm border border-gray-200 flex flex-col card-height overflow-hidden">
    <div class="p-4 bg-gray-50 border-b border-gray-100 flex justify-between items-center">
        <h2 class="font-bold text-gray-700">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ø§Ù„ (120 Ø¹Ø§Ù…Ù„)</h2>
    </div>
    <div class="flex-1 overflow-y-auto custom-scroll">
      <table class="w-full text-[11px] text-center">
        <thead class="bg-gray-50 sticky top-0 border-b z-10 font-bold text-gray-600">
          <tr>
            <th class="p-3">ID</th>
            <th class="p-3 text-right">Ø§Ù„Ø§Ø³Ù…</th>
            <th class="p-3">Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th class="p-3">Ø§Ù„ÙˆØ±Ø¯ÙŠØ©</th>
            <th class="p-3">Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
            <th class="p-3">Ø¹Ø±Ø¶</th>
          </tr>
        </thead>
        <tbody id="workersList" class="divide-y divide-gray-50"></tbody>
      </table>
    </div>
  </div>

  <div class="bg-white rounded-2xl shadow-sm border border-gray-200 flex flex-col card-height overflow-hidden">
    <div class="p-4 bg-red-50 border-b border-red-100"><h2 class="font-bold text-red-700">ğŸ“ Ù…Ù†Ø§Ø·Ù‚ ØªØ­Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© (ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¨ÙŠØ¦ÙŠØ©)</h2></div>
    <div class="flex-1 overflow-y-auto custom-scroll">
      <table class="w-full text-[11px] text-center">
        <thead class="bg-gray-50 sticky top-0 border-b z-10 font-bold text-gray-600">
          <tr>
            <th class="p-3">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th>
            <th class="p-3 text-right">Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ø°ÙŠØ±</th>
            <th class="p-3">Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø±</th>
            <th class="p-3">Ø§Ù„Ø¹Ù…Ø§Ù„</th>
            <th class="p-3">Ø§Ù„Ù…Ø´Ø±Ù</th>
            <th class="p-3">Ø¹Ø±Ø¶</th>
          </tr>
        </thead>
        <tbody id="zonesDangerList" class="divide-y divide-gray-50"></tbody>
      </table>
    </div>
  </div>

  <div class="bg-white rounded-2xl shadow-sm border border-gray-200 flex flex-col card-height overflow-hidden">
    <div class="p-4 bg-indigo-50 border-b border-indigo-100 flex justify-between items-center">
      <h2 class="font-bold text-indigo-700">ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</h2>
      <select id="zoneFilter" onchange="updateZoneAnalytics()" class="text-xs border rounded px-2 py-1 outline-none">
        <option value="ZoneA">Zone A</option>
        <option value="ZoneB">Zone B</option>
        <option value="ZoneC">Zone C</option>
        <option value="ZoneD">Zone D</option>
        <option value="ZoneE">Zone E</option>
      </select>
    </div>
    <div class="p-4 flex-1 overflow-y-auto custom-scroll">
      <div class="grid grid-cols-2 gap-4 mb-4 text-center">
        <div class="bg-gray-50 p-2 rounded-lg border">
          <span class="block text-[10px] text-gray-400">Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</span>
          <span id="ana-sup" class="font-bold text-xs text-gray-700">--</span>
        </div>
        <div class="bg-gray-50 p-2 rounded-lg border">
          <span class="block text-[10px] text-gray-400">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­ÙˆØ§Ø¯Ø«</span>
          <span id="ana-risk" class="font-bold text-xs text-red-500">--</span>
        </div>
      </div>
      <h3 class="text-[11px] font-bold text-gray-500 mb-2">Ø§Ù„Ø¹Ù…Ø§Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹ (<span id="ana-count">0</span>):</h3>
      <ul id="ana-workers-list" class="space-y-1 text-[11px]"></ul>
    </div>
  </div>

  <div class="bg-white rounded-2xl shadow-sm border border-gray-200 flex flex-col card-height overflow-hidden">
    <div class="p-4 bg-green-50 border-b border-green-100"><h2 class="font-bold text-green-700">ğŸ“¡ Ø´Ø¨ÙƒØ© Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª ÙˆØ§Ù„Ø³Ø§Ø¹Ø§Øª</h2></div>
    <div class="p-4 flex-1 overflow-y-auto custom-scroll">
      <div class="flex justify-around mb-6 border-b pb-4 text-center">
        <div>
            <span class="text-2xl font-black text-green-600">342</span>
            <span class="block text-[10px] text-gray-400 font-bold uppercase">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª</span>
        </div>
        <div>
            <span class="text-2xl font-black text-indigo-600">120</span>
            <span class="block text-[10px] text-gray-400 font-bold uppercase">Ø³Ø§Ø¹Ø© Ø°ÙƒÙŠØ©</span>
        </div>
        <div>
            <span class="text-2xl font-black text-blue-600">18</span>
            <span class="block text-[10px] text-gray-400 font-bold uppercase">Ø¨ÙˆØ§Ø¨Ø© LoRaWAN</span>
        </div>
      </div>
      <h3 class="text-[11px] font-bold text-red-500 mb-2 flex items-center gap-1">ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§ØªØµØ§Ù„:</h3>
      <div id="offline-list" class="space-y-1">
          <div class="bg-red-50 p-2 rounded border border-red-100 flex justify-between text-[10px]">
              <span class="font-bold text-red-800 tracking-tight">Watch_ID_1088 (Ø£Ù†Ø³ Ø±Ø§Ø¦Ø¯)</span>
              <span class="text-red-500 font-bold">Offline (18m)</span>
          </div>
      </div>
    </div>
  </div>

</div>

<div id="modalWorker" class="hidden fixed inset-0 bg-black/90 backdrop-blur-md flex items-center justify-center z-50 p-4">
    <div class="bg-white w-full max-w-5xl rounded-3xl shadow-2xl flex flex-col md:flex-row border-t-8 border-indigo-600 overflow-hidden">
        <div class="p-8 flex-1 text-right">
            <div class="flex justify-between border-b pb-4 mb-4">
                <div><h3 id="det-name" class="text-2xl font-black text-gray-800">--</h3><p id="det-id" class="text-indigo-600 font-bold">--</p></div>
                <div id="det-shift" class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-[10px] h-fit font-bold">--</div>
            </div>
            <p class="text-sm text-gray-600 mb-4"><b>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</b> <span id="det-loc">--</span> | <b>Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</b> <span id="det-sup">--</span></p>
            <div id="sketch-map"><div id="ZoneA" class="zone-box">Zone A</div><div id="ZoneB" class="zone-box">Zone B</div><div id="ZoneC" class="zone-box">Zone C</div><div id="ZoneD" class="zone-box">Zone D</div><div id="ZoneE" class="zone-box">Zone E</div><div id="workerDot" class="worker-dot"></div></div>
            <div class="mt-6 flex gap-2"><button onclick="confirmAction()" class="flex-1 bg-black text-white font-bold py-3 rounded-xl">ØªÙ…Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</button><button onclick="closeWorkerModal()" class="flex-1 py-3 bg-gray-100 rounded-xl">Ø¥ØºÙ„Ø§Ù‚</button></div>
        </div>
    </div>
</div>

<script>
// Logic remains unchanged as requested
const zones = ["ZoneA", "ZoneB", "ZoneC", "ZoneD", "ZoneE"];
const sups = ["Ù…. Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø£ÙŠÙ…Ù†", "Ù…. Ø³Ù„Ø·Ø§Ù† Ø­Ù…Ø¯", "Ù…. ÙÙŠØµÙ„ Ø¹Ù„ÙŠ", "Ù…. ÙÙ‡Ø¯ Ø­Ø³Ù†", "Ù…. Ø±Ø§Ø¦Ø¯ Ø³Ø§Ù…ÙŠ"];
const namesAr = ["Ø®Ø§Ù„Ø¯", "Ø£Ø­Ù…Ø¯", "Ø¹Ù…Ø±", "Ø³Ø¹Ø¯", "Ù…Ø§Ø¬Ø¯", "ÙŠØ§Ø³Ø±", "Ø³Ù„Ø·Ø§Ù†", "ÙÙŠØµÙ„", "Ø³Ø¹ÙˆØ¯", "Ù†Ø§ÙŠÙ"];
const midNames = ["Ø£Ù†Ø³", "Ø³Ø§Ù„Ù…", "Ø¬Ù…Ø§Ù„", "Ø±Ø§Ø¦Ø¯", "Ù…Ù†ØµÙˆØ±", "ÙˆÙ„ÙŠØ¯", "Ø³Ø§Ù…ÙŠ", "Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…", "Ø­Ø³Ø§Ù†", "Ø²ÙŠØ§Ø¯"];
const namesEn = ["Michael", "John", "David", "Robert", "James", "William", "Chris", "Thomas", "Daniel", "Kevin"];

let workers = [];
for(let i=1; i<=120; i++){
    let isAr = Math.random() > 0.5;
    let name = isAr ? 
               (namesAr[Math.floor(Math.random()*namesAr.length)] + " " + midNames[Math.floor(Math.random()*midNames.length)]) :
               (namesEn[Math.floor(Math.random()*namesEn.length)] + " " + namesEn[Math.floor(Math.random()*namesEn.length)]);
    let zoneIdx = Math.floor(Math.random()*zones.length);
    let severity = (i % 18 === 0) ? "critical" : (i % 10 === 0) ? "warning" : "normal";
    let trigger = severity === "critical" ? "Ø®Ø·Ø±: Ù†Ø¨Ø¶ Ù…Ø±ØªÙØ¹" : severity === "warning" ? "ØªÙ†Ø¨ÙŠÙ‡: Ø¥Ø¬Ù‡Ø§Ø¯" : "Ù…Ø³ØªÙ‚Ø±";
    workers.push({ id: 1000 + i, name: name, shift: (Math.floor(Math.random()*7) + 2) + " Ø³Ø§Ø¹Ø§Øª", sup: sups[zoneIdx], trigger: trigger, severity: severity, location: zones[zoneIdx] });
}

let zonesDanger = [
    { id: 1, zone: "ZoneA", alert: "ØªØ³Ø±ÙŠØ¨ ØºØ§Ø² CH4", status: "Ø®Ø·Ø± Ø­Ø±Ø¬", sup: "Ù…. Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø£ÙŠÙ…Ù†", severity: "critical" },
    { id: 2, zone: "ZoneC", alert: "Ø§Ù‡ØªØ²Ø§Ø²Ø§Øª ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠØ©", status: "ØªØ­Ø°ÙŠØ± Ù…ØªÙˆØ³Ø·", sup: "Ù…. ÙÙŠØµÙ„ Ø¹Ù„ÙŠ", severity: "warning" },
    { id: 3, zone: "ZoneE", alert: "Ø§Ø±ØªÙØ§Ø¹ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…Ø­ÙŠØ·", status: "Ø®Ø·Ø± Ø­Ø±Ø¬", sup: "Ù…. Ø±Ø§Ø¦Ø¯ Ø³Ø§Ù…ÙŠ", severity: "critical" }
];

function refreshWorkers(){
    let sorted = [...workers].sort((a,b)=>{const rank={critical:1,warning:2,normal:3}; return rank[a.severity]-rank[b.severity];});
    document.getElementById("workersList").innerHTML = sorted.map(w => {
        let color = w.severity==="critical"? "bg-red-600 animate-pulse": w.severity==="warning"? "bg-orange-500":"bg-green-500";
        return `<tr class="border-b">
            <td class="p-3 font-mono font-bold">${w.id}</td>
            <td class="p-3 text-right font-bold text-gray-700">${w.name}</td>
            <td class="p-3"><div class="${color} text-white text-[8px] px-2 py-0.5 rounded">${w.trigger}</div></td>
            <td class="p-3 text-gray-500 text-[10px]">${w.shift}</td>
            <td class="p-3 font-bold text-indigo-600">${w.location}</td>
            <td class="p-3"><button onclick="openWorkerModal(${w.id})" class="bg-[#6842E2] text-white px-3 py-1 rounded text-[9px] font-bold">Ø¹Ø±Ø¶</button></td>
        </tr>`;
    }).join("");
}

function refreshZones(){
    document.getElementById("zonesDangerList").innerHTML = zonesDanger.map(z => {
        let color = z.severity === "critical" ? "bg-red-600 animate-pulse" : "bg-orange-500";
        return `<tr class="border-b">
            <td class="p-3 font-bold text-gray-800">${z.zone}</td>
            <td class="p-3 text-right text-gray-600">${z.alert}</td>
            <td class="p-3"><div class="${color} text-white text-[8px] px-2 py-0.5 rounded">${z.status}</div></td>
            <td class="p-3 font-bold text-blue-600">${workers.filter(w => w.location === z.zone).length} Ø¹Ù…Ø§Ù„</td>
            <td class="p-3 font-bold text-gray-700">${z.sup}</td>
            <td class="p-3"><button onclick="alert('ÙØªØ­ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù„Ù€ '+ '${z.zone}')" class="bg-[#6842E2] text-white px-3 py-1 rounded text-[9px] font-bold">Ø¹Ø±Ø¶</button></td>
        </tr>`;
    }).join("");
}

function updateZoneAnalytics(){
    const zone = document.getElementById("zoneFilter").value;
    const local = workers.filter(w => w.location === zone);
    document.getElementById("ana-sup").textContent = sups[zones.indexOf(zone)];
    document.getElementById("ana-risk").textContent = (Math.random()*4+1).toFixed(1) + "%";
    document.getElementById("ana-count").textContent = local.length;
    document.getElementById("ana-workers-list").innerHTML = local.map(w => 
        `<li class="bg-white border-r-4 border-indigo-500 p-2 rounded shadow-sm flex justify-between text-[10px] mb-1">
            <span class="font-bold text-gray-700">${w.name}</span> 
            <span class="text-gray-400 font-mono">ID:${w.id}</span>
        </li>`
    ).join("");
}

let activeWorker, moveInt;
function openWorkerModal(id){
    activeWorker = workers.find(x => x.id === id);
    document.getElementById("det-name").textContent = activeWorker.name;
    document.getElementById("det-id").textContent = "Worker ID: " + activeWorker.id;
    document.getElementById("det-shift").textContent = "Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: " + activeWorker.shift;
    document.getElementById("det-loc").textContent = activeWorker.location;
    document.getElementById("det-sup").textContent = activeWorker.sup;
    document.getElementById("modalWorker").classList.remove("hidden");
    clearInterval(moveInt); placeWorkerOnMap(); moveInt = setInterval(placeWorkerOnMap, 1200);
}
function placeWorkerOnMap(){
    let dot=document.getElementById("workerDot");
    let zoneElem=document.getElementById(activeWorker.location);
    if(!zoneElem) return;
    dot.style.left=(zoneElem.offsetLeft+Math.random()*(zoneElem.clientWidth-14))+"px";
    dot.style.top=(zoneElem.offsetTop+Math.random()*(zoneElem.clientHeight-14))+"px";
}
function confirmAction(){ workers=workers.filter(w=>w.id!==activeWorker.id); refreshWorkers(); updateZoneAnalytics(); closeWorkerModal(); }
function closeWorkerModal(){ clearInterval(moveInt); document.getElementById("modalWorker").classList.add("hidden"); }

refreshWorkers(); refreshZones(); updateZoneAnalytics();
</script>
</body>
</html>
