<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>ProActive Safety - Ultimate Recovery</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
  :root { --main-bg: #111827; --card-bg: #1f2937; --turquoise: #28E7C4; --purple-blue: #6842E2; }
  body { font-family: 'Tajawal', sans-serif; background: var(--main-bg); color: #f3f4f6; margin: 0; padding: 0; }
  .pro-card { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.05); border-radius: 1.5rem; height: 500px; display: flex; flex-direction: column; overflow: hidden; }
  .custom-scroll::-webkit-scrollbar { width: 5px; }
  .custom-scroll::-webkit-scrollbar-thumb { background: var(--purple-blue); border-radius: 10px; }
  .info-box { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; margin-bottom: 6px; text-align: right; }
  .detailed-map { width: 100%; height: 140px; background: #0f172a; border-radius: 15px; position: relative; border: 1px solid #334155; }
  .worker-marker { width: 12px; height: 12px; border-radius: 50%; position: absolute; border: 2px solid white; box-shadow: 0 0 10px rgba(255,255,255,0.5); z-index: 20; transition: all 1s ease; }
  .live-dot { width: 8px; height: 8px; background: #ef4444; border-radius: 50%; display: inline-block; margin-left: 5px; animation: blink 1s infinite; }
  @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
</style>
</head>
<body class="p-6">

<header class="bg-gradient-to-r from-[#6842E2] to-[#5833d1] text-white px-8 h-[90px] rounded-3xl mb-8 flex justify-between items-center shadow-2xl relative">
  <div class="w-1/4"><h1 class="text-xl font-black uppercase tracking-widest">ProActive</h1></div>
  <div class="absolute inset-y-0 left-1/2 transform -translate-x-1/2 flex items-center">
    <img src="proactivewhite.png" alt="Logo" class="h-12 object-contain">
  </div>
  <div class="w-1/4 text-left font-bold text-[11px] bg-white/10 px-4 py-2 rounded-full border border-white/20 uppercase">Safety Command Center</div>
</header>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

  <section class="pro-card shadow-lg">
    <div class="p-4 border-b border-red-500/20 bg-red-500/10 flex flex-col gap-4">
        <h2 class="font-bold text-red-500 flex items-center gap-2 text-sm"><span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span> Ø¹Ù…Ø§Ù„ ÙÙŠ Ø®Ø·Ø±</h2>
        <div class="flex gap-2">
            <button onclick="switchWorkerFilter('active')" id="btn-w-active" class="flex-1 py-2 text-[11px] font-bold rounded-xl bg-purple-blue text-white shadow-lg">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
            <button onclick="switchWorkerFilter('completed')" id="btn-w-completed" class="flex-1 py-2 text-[11px] font-bold rounded-xl bg-white/5 text-gray-400">ØªÙ…Øª Ù…Ø¨Ø§Ø´Ø±ØªÙ‡Ø§</button>
        </div>
    </div>
    <div class="flex-1 overflow-y-auto custom-scroll">
      <table class="w-full text-[11px] text-center">
        <thead class="bg-black/20 sticky top-0 text-turquoise">
          <tr><th class="p-4">Ø§Ù„Ø±Ù‚Ù…</th><th class="p-4 text-right">Ø§Ù„Ø§Ø³Ù…</th><th class="p-4">Ø§Ù„Ø­Ø§Ù„Ø©</th><th class="p-4">Ø§Ù„Ù…ÙˆÙ‚Ø¹</th><th class="p-4">Ø§Ù„ÙˆÙ‚Øª</th><th class="p-4">Ø¹Ø±Ø¶</th></tr>
        </thead>
        <tbody id="workersList" class="divide-y divide-white/5 text-gray-300"></tbody>
      </table>
    </div>
  </section>

  <section class="pro-card shadow-lg">
    <div class="p-4 border-b border-orange-500/20 bg-orange-500/10 flex flex-col gap-4">
        <h2 class="font-bold text-orange-400 text-sm flex items-center gap-2">ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ø¨ÙŠØ¦ÙŠØ©</h2>
        <div class="flex gap-2">
            <button onclick="switchZoneFilter('active')" id="btn-z-active" class="flex-1 py-2 text-[11px] font-bold rounded-xl bg-purple-blue text-white shadow-lg">Ù†Ø´Ø·Ø©</button>
            <button onclick="switchZoneFilter('completed')" id="btn-z-completed" class="flex-1 py-2 text-[11px] font-bold rounded-xl bg-white/5 text-gray-400">Ù…ØºÙ„Ù‚Ø©</button>
        </div>
    </div>
    <div class="flex-1 overflow-y-auto custom-scroll">
      <table class="w-full text-[11px] text-center">
        <thead class="bg-black/20 sticky top-0 text-turquoise">
          <tr><th class="p-4">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</th><th class="p-4">Ø§Ù„ØªØ­Ø°ÙŠØ±</th><th class="p-4">Ø§Ù„Ø®Ø·Ø±</th><th class="p-4">Ø§Ù„Ø¹Ù…Ø§Ù„</th><th class="p-4">ØªØ­Ù„ÙŠÙ„</th></tr>
        </thead>
        <tbody id="zonesList" class="divide-y divide-white/5 text-gray-300"></tbody>
      </table>
    </div>
  </section>

  <section class="pro-card shadow-lg">
    <div class="p-4 border-b border-purple-500/20 bg-purple-500/10 flex justify-between items-center text-right">
        <h2 class="font-bold text-purple-400 text-sm">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø°ÙƒÙŠØ©</h2>
        <select onchange="loadRegionStats(this.value)" class="bg-black/40 text-turquoise text-[11px] px-2 py-1 rounded border border-purple-500/30 outline-none">
            <option value="A">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© A</option><option value="B">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© B</option><option value="C">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© C</option><option value="D">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© D</option><option value="E">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© E</option>
        </select>
    </div>
    <div class="p-6 flex-1 flex flex-col gap-4 text-right overflow-y-auto custom-scroll">
        <div class="grid grid-cols-2 gap-3">
            <div class="bg-white/5 p-4 rounded-2xl border border-white/5"><span class="text-[10px] text-gray-400 block mb-1">Ø¥ØµØ§Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</span><span id="reg-injuries" class="text-2xl font-black text-white">--</span></div>
            <div class="bg-white/5 p-4 rounded-2xl border border-white/5"><span class="text-[10px] text-gray-400 block mb-1">ØªØ­Ø°ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª</span><span id="reg-alerts" class="text-2xl font-black text-orange-400">--</span></div>
        </div>
        <div class="bg-black/30 p-4 rounded-2xl border border-white/5">
            <span class="text-[10px] text-gray-400 block mb-2 uppercase tracking-tighter">Ù†Ø³Ø¨Ø© ÙˆÙ‚ÙˆØ¹ Ø®Ø·Ø± (ØªÙ†Ø¨Ø¤ AI)</span>
            <div class="flex items-center gap-4">
                <span id="reg-risk-val" class="text-3xl font-black text-red-500 w-16">0%</span>
                <div class="flex-1 bg-white/10 h-2 rounded-full overflow-hidden"><div id="reg-risk-bar" class="bg-red-500 h-full transition-all duration-1000" style="width: 0%"></div></div>
            </div>
        </div>
        <div class="bg-purple-blue/10 p-4 rounded-2xl border border-purple-blue/20">
            <h4 class="font-bold text-purple-300 text-[10px] mb-1 flex items-center gap-2">ğŸ¤– Predictive Recommendation:</h4>
            <p id="reg-ai-msg" class="text-[11px] text-gray-300 italic leading-relaxed"></p>
        </div>
    </div>
  </section>

  <section class="pro-card shadow-lg bg-black/20 text-right">
    <div class="p-4 border-b border-white/5 bg-turquoise/5"><h2 class="font-bold text-turquoise text-sm">ğŸ“¡ Ø­Ø§Ù„Ø© Ø´Ø¨ÙƒØ© Ø§Ù„Ø­Ø³Ø§Ø³Ø§Øª</h2></div>
    <div class="p-8 grid grid-cols-3 gap-3 text-center">
         <div class="bg-white/5 p-4 rounded-xl border border-white/5"><span class="text-2xl font-bold text-white block">342</span><span class="text-[9px] text-gray-500 uppercase">Sensors</span></div>
         <div class="bg-white/5 p-4 rounded-xl border border-white/5"><span class="text-2xl font-bold text-white block">120</span><span class="text-[9px] text-gray-500 uppercase">Wearables</span></div>
         <div class="bg-white/5 p-4 rounded-xl border border-white/5"><span class="text-2xl font-bold text-turquoise block">18</span><span class="text-[9px] text-gray-500 uppercase">Nodes</span></div>
    </div>
  </section>
</div>

<div id="workerModal" class="hidden fixed inset-0 bg-black/95 backdrop-blur-md flex items-center justify-center z-[300] p-4 text-right">
    <div class="bg-[#1f2937] w-full max-w-5xl rounded-[2rem] shadow-2xl border border-white/10 overflow-hidden flex flex-col md:flex-row h-[85vh]">
        <div class="w-full md:w-1/3 bg-black/20 p-6 border-l border-white/5 flex flex-col">
            <h3 class="text-gray-400 text-[10px] mb-4 font-bold uppercase tracking-widest">Health Profile</h3>
            <div class="info-box"><p class="text-[9px] text-gray-500 uppercase">Ø§Ù„Ø§Ø³Ù…</p><p id="w-modal-name" class="font-bold text-white text-lg"></p></div>
            <div class="info-box"><p class="text-[9px] text-gray-500 uppercase">Ø§Ù„Ù…Ø´Ø±Ù</p><p id="w-modal-sup" class="text-xs font-bold text-orange-400"></p></div>
            <div class="info-box"><p class="text-[9px] text-gray-500 uppercase">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ©</p><p id="w-modal-med" class="text-xs font-bold text-red-400"></p></div>
            <p class="text-[10px] text-turquoise mt-4 mb-2 font-bold">ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ:</p>
            <div class="detailed-map"><div id="w-modal-marker" class="worker-marker"></div></div>
        </div>
        <div class="flex-1 p-8 flex flex-col gap-6 overflow-y-auto">
            <div class="flex justify-between items-center"><h2 class="text-xl font-black text-white flex items-center gap-2"><span class="live-dot"></span> Ø¨ÙŠØ§Ù†Ø§Øª Ø­ÙŠÙˆÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø©</h2><button onclick="closeWorkerModal()" class="text-gray-400 text-2xl">âœ•</button></div>
            <div class="grid grid-cols-3 gap-4 text-center">
                <div class="bg-black/40 p-5 rounded-2xl border border-white/5"><span class="text-[9px] text-gray-500 block mb-1">BPM</span><span id="w-live-bpm" class="text-4xl font-black text-red-500">--</span></div>
                <div class="bg-black/40 p-5 rounded-2xl border border-white/5"><span class="text-[9px] text-gray-500 block mb-1">BP (SYS/DIA)</span><span class="text-2xl font-black text-orange-400">133/85</span></div>
                <div class="bg-black/40 p-5 rounded-2xl border border-white/5"><span class="text-[9px] text-gray-500 block mb-1">TEMP Â°C</span><span id="w-live-temp" class="text-4xl font-black text-turquoise">--</span></div>
            </div>
            <div class="bg-[#6842E2]/10 p-5 rounded-2xl border border-[#6842E2]/20"><h4 class="font-bold text-[#6842E2] text-[11px] mb-1">ğŸ¤– ProActive AI Recommendation:</h4><div id="w-live-ai" class="text-sm text-gray-300 italic"></div></div>
            <div class="grid grid-cols-2 gap-4 text-center">
                <div class="bg-white/5 p-4 rounded-xl border border-white/5"><span class="text-[10px] text-gray-400 block uppercase">Steps</span><span id="w-live-steps" class="text-2xl font-bold text-white">--</span></div>
                <div class="bg-white/5 p-4 rounded-xl border border-white/5"><span class="text-[10px] text-gray-400 block uppercase">Kcal</span><span id="w-live-kcal" class="text-2xl font-bold text-white">--</span></div>
            </div>
            <button id="w-complete-btn" onclick="markWorkerSafe()" class="w-full bg-[#10b981] text-white font-black py-5 rounded-2xl mt-auto shadow-xl">ØªÙ…Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø­Ø§Ù„Ø©</button>
        </div>
    </div>
</div>

<div id="zoneModal" class="hidden fixed inset-0 bg-black/95 backdrop-blur-md flex items-center justify-center z-[300] p-4 text-right">
    <div class="bg-[#1f2937] w-full max-w-5xl rounded-[2.5rem] shadow-2xl border border-white/10 overflow-hidden flex flex-col md:flex-row h-[85vh]">
        <div class="w-full md:w-1/3 bg-black/20 p-6 border-l border-white/5 flex flex-col">
            <h3 class="text-gray-400 text-[10px] mb-4 font-bold uppercase">Zone Intel</h3>
            <div class="info-box"><p id="z-modal-title" class="font-bold text-white text-lg"></p></div>
            <div class="info-box"><p id="z-modal-metric" class="text-xl font-black text-turquoise"></p></div>
            <div class="info-box"><p class="text-[9px] text-gray-500 uppercase font-bold">Ø§Ù„Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ØªØ¨Ù‚ÙˆÙ†</p><p id="z-modal-count" class="text-xl font-black text-white">0</p></div>
        </div>
        <div class="flex-1 p-8 flex flex-col gap-6 overflow-y-auto">
            <div class="flex justify-between items-center"><h2 class="text-xl font-black text-white">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ø°ÙƒÙŠ</h2><button onclick="closeZoneModal()" class="text-gray-400 text-2xl">âœ•</button></div>
            <div id="z-evac-list" class="grid grid-cols-2 md:grid-cols-3 gap-3 bg-black/20 p-4 rounded-xl min-h-[100px]"></div>
            <div class="bg-[#6842E2]/10 p-5 rounded-2xl border border-[#6842E2]/20"><h4 class="font-bold text-[#6842E2] text-[11px] mb-1">ğŸ¤– AI Zone Analysis:</h4><div id="z-modal-ai" class="text-sm text-gray-300 italic leading-relaxed"></div></div>
            <button id="z-complete-btn" onclick="markZoneSafe()" class="w-full bg-[#10b981] text-white font-black py-5 rounded-2xl mt-auto shadow-xl transition-all">ØªÙ… Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¨Ù„Ø§Øº</button>
        </div>
    </div>
</div>

<script>
// --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ---
let currentWFilter = 'active';
let currentZFilter = 'active';
let wInterval; let zInterval; let activeWorker; let activeZone;

let workers = [
    { id: 101, name: "Ø®Ø§Ù„Ø¯ Ø£Ù†Ø³", severity: "critical", alert: "Ù†Ø¨Ø¶ Ø­Ø±Ø¬", zone: "Zone A", time: "08:12", sup: "Ù…. Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡", medical: "Ø¶ØºØ· Ù…Ø²Ù…Ù†", steps: 8420, x: 30, y: 40, status: 'active' },
    { id: 102, name: "Ø£Ø­Ù…Ø¯ Ø³Ø§Ù„Ù…", severity: "warning", alert: "Ø¥Ø¬Ù‡Ø§Ø¯ Ø­Ø±Ø§Ø±ÙŠ", zone: "Zone C", time: "08:45", sup: "Ù…. Ø³Ù„Ø·Ø§Ù†", medical: "Ø³Ù„ÙŠÙ…", steps: 12104, x: 70, y: 20, status: 'active' },
    { id: 105, name: "Ø³Ù„Ø·Ø§Ù† Ù…Ù†ØµÙˆØ±", severity: "simple", alert: "ØªØ¹Ø¨ Ø¹Ø§Ù…", zone: "Zone D", time: "09:20", sup: "Ù…. Ø³Ù„Ø·Ø§Ù†", medical: "Ø³Ù„ÙŠÙ…", steps: 15200, x: 80, y: 50, status: 'active' }
];

let zones = [
    { id: 'gas', title: "Zone A", sub: "ØªØ³Ø±ÙŠØ¨ ØºØ§Ø² CH4", metric: "920 PPM", risk: "92%", status: 'active', workers: ["Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ", "ÙÙ‡Ø¯ Ø®Ø§Ù„Ø¯", "Ø³Ù„Ù…Ø§Ù† Ù…Ù†ØµÙˆØ±", "ÙˆØ§Ø¦Ù„ Ù…Ø­Ù…Ø¯"], ai: "ğŸš¨ <b>ØªØ­Ù„ÙŠÙ„:</b> Ø®Ø·Ø± Ø§Ù†ÙØ¬Ø§Ø± Ø¹Ø§Ù„ÙŠ Ø¨Ø³Ø¨Ø¨ ØªØ±ÙƒÙŠØ² Ø§Ù„Ù…ÙŠØ«Ø§Ù†.<br>âœ… <b>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</b> Ù‚Ø·Ø¹ Ø§Ù„ØªÙŠØ§Ø± Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ ÙÙˆØ±Ø§Ù‹." },
    { id: 'heat', title: "Zone C", sub: "Ø§Ø±ØªÙØ§Ø¹ Ø­Ø±Ø§Ø±Ø©", metric: "58Â°C", risk: "78%", status: 'active', workers: ["Ø³Ø¹Ø¯ Ø¬Ù…Ø§Ù„", "Ù…Ø§Ø¬Ø¯ Ø³Ø§Ù…ÙŠ", "ÙÙŠØµÙ„ ÙˆÙ„ÙŠØ¯"], ai: "âš ï¸ <b>ØªØ­Ù„ÙŠÙ„:</b> Ø®Ø·Ø± Ø¥Ø¬Ù‡Ø§Ø¯ Ø­Ø±Ø§Ø±ÙŠ.<br>âœ… <b>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</b> Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ." }
];

const regions = {
    'A': { injuries: 4, alerts: 156, risk: 88, ai: "ğŸš¨ <b>ØªØ­Ù„ÙŠÙ„:</b> Ø§Ù„Ù‚Ø·Ø§Ø¹ A Ø§Ù„Ø£ÙƒØ«Ø± Ø¹Ø±Ø¶Ø© Ù„Ù„Ø­Ø±Ø§Ø¦Ù‚.<br>âœ… <b>Ø§Ù„ØªÙˆØµÙŠØ©:</b> ØªØ­Ø¯ÙŠØ« Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø¥Ø®Ù…Ø§Ø¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ." },
    'B': { injuries: 1, alerts: 42, risk: 15, ai: "âœ… <b>ØªØ­Ù„ÙŠÙ„:</b> Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ù…Ø«Ø§Ù„ÙŠØ© ÙˆÙ…Ø³ØªÙ‚Ø±Ø©." },
    'C': { injuries: 7, alerts: 230, risk: 94, ai: "ğŸ”¥ <b>ØªØ­Ù„ÙŠÙ„:</b> Ø¶ØºØ· Ø¹Ù…Ù„ Ù‡Ø§Ø¦Ù„ ÙÙŠ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© C.<br>âœ… <b>Ø§Ù„ØªÙˆØµÙŠØ©:</b> Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ ÙØªØ±Ø§Øª Ø§Ù„Ø±Ø§Ø­Ø©." },
    'D': { injuries: 2, alerts: 88, risk: 45, ai: "âš ï¸ <b>ØªØ­Ù„ÙŠÙ„:</b> Ø±ØµØ¯ ØªÙ„ÙˆØ« Ù‡ÙˆØ§Ø¦ÙŠ Ø¹Ø§Ø¨Ø±." },
    'E': { injuries: 0, alerts: 12, risk: 5, ai: "ğŸ’ <b>ØªØ­Ù„ÙŠÙ„:</b> Ù…Ù†Ø·Ù‚Ø© Ø¢Ù…Ù†Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„." }
};

// --- Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„ ---
function renderWorkers() {
    const tbody = document.getElementById("workersList");
    const filtered = workers.filter(w => w.status === currentWFilter);
    tbody.innerHTML = filtered.map(w => `
        <tr class="border-b border-white/5">
            <td class="p-4 font-mono text-turquoise">${w.id}</td>
            <td class="p-4 text-right font-bold text-gray-200">${w.name}</td>
            <td class="p-4 font-bold text-${w.severity==='critical'?'red':w.severity==='warning'?'orange':'yellow'}-500">${w.alert}</td>
            <td class="p-4">${w.zone}</td>
            <td class="p-4 text-gray-500">${w.time}</td>
            <td class="p-4"><button onclick="openWorkerModal(${w.id})" class="bg-[#fb923c] text-white px-4 py-1.5 rounded-xl font-bold">Ø¹Ø±Ø¶</button></td>
        </tr>`).join("");
}

function openWorkerModal(id) {
    activeWorker = workers.find(w => w.id === id);
    document.getElementById("w-modal-name").innerText = activeWorker.name;
    document.getElementById("w-modal-sup").innerText = activeWorker.sup;
    document.getElementById("w-modal-med").innerText = activeWorker.medical;
    document.getElementById("w-modal-marker").style.left = activeWorker.x + "%";
    document.getElementById("w-modal-marker").style.top = activeWorker.y + "%";
    document.getElementById("w-live-ai").innerHTML = activeWorker.severity === 'critical' ? "ğŸš¨ Ø®Ø·Ø± Ø­Ø§Ø¯: ØªØ³Ø§Ø±Ø¹ Ù†Ø¨Ø¶ Ù„Ù…Ø±ÙŠØ¶ Ø¶ØºØ·. Ø§Ø³ØªØ¯Ø¹Ù Ø§Ù„Ù…Ø´Ø±Ù ÙÙˆØ±Ø§Ù‹." : "â„¹ï¸ Ø­Ø§Ù„Ø© Ù…Ø³ØªÙ‚Ø±Ø© Ù…Ø¹ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¥Ø±Ù‡Ø§Ù‚.";
    
    updateWorkerStats();
    clearInterval(wInterval);
    wInterval = setInterval(updateWorkerStats, 3000);
    document.getElementById("workerModal").classList.remove("hidden");
}

function updateWorkerStats() {
    if(!activeWorker) return;
    document.getElementById("w-live-bpm").innerText = (activeWorker.severity==='critical'?120:78) + Math.floor(Math.random()*6);
    document.getElementById("w-live-temp").innerText = (activeWorker.severity==='warning'?38.4:37.1 + Math.random()).toFixed(1);
    document.getElementById("w-live-steps").innerText = (activeWorker.steps += 1).toLocaleString();
    document.getElementById("w-live-kcal").innerText = Math.floor(activeWorker.steps / 20);
}

function switchWorkerFilter(f) {
    currentWFilter = f;
    document.getElementById('btn-w-active').className = f==='active'?"flex-1 py-2 text-[11px] font-bold rounded-xl bg-purple-blue text-white shadow-lg":"flex-1 py-2 text-[11px] font-bold rounded-xl bg-white/5 text-gray-400";
    document.getElementById('btn-w-completed').className = f==='completed'?"flex-1 py-2 text-[11px] font-bold rounded-xl bg-purple-blue text-white shadow-lg":"flex-1 py-2 text-[11px] font-bold rounded-xl bg-white/5 text-gray-400";
    renderWorkers();
}

function markWorkerSafe() { activeWorker.status = 'completed'; closeWorkerModal(); renderWorkers(); }
function closeWorkerModal() { clearInterval(wInterval); document.getElementById("workerModal").classList.add("hidden"); }

// --- Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù†ÙŠ ---
function renderZones() {
    const tbody = document.getElementById("zonesList");
    const filtered = zones.filter(z => z.status === currentZFilter);
    tbody.innerHTML = filtered.map(z => `
        <tr class="border-b border-white/5">
            <td class="p-4 font-bold text-white">${z.title}</td>
            <td class="p-4 text-right">${z.sub}</td>
            <td class="p-4 font-bold text-red-500">${z.risk}</td>
            <td class="p-4 text-turquoise font-bold">${z.workers.length}</td>
            <td class="p-4"><button onclick="openZoneModal('${z.id}')" class="bg-[#fb923c] text-white px-4 py-1.5 rounded-xl font-bold">ØªØ­Ù„ÙŠÙ„</button></td>
        </tr>`).join("");
}

function openZoneModal(id) {
    activeZone = zones.find(z => z.id === id);
    document.getElementById("z-modal-title").innerText = activeZone.title;
    document.getElementById("z-modal-metric").innerText = activeZone.metric;
    document.getElementById("z-modal-ai").innerHTML = activeZone.ai;
    document.getElementById("z-complete-btn").style.display = activeZone.status === 'completed' ? 'none' : 'block';
    
    let tempW = [...activeZone.workers];
    updateEvacDisplay(tempW);
    
    document.getElementById("zoneModal").classList.remove("hidden");
    clearInterval(zInterval);
    zInterval = setInterval(() => { if(tempW.length > 0) { tempW.pop(); updateEvacDisplay(tempW); } else clearInterval(zInterval); }, 3000);
}

function updateEvacDisplay(list) {
    document.getElementById("z-modal-count").innerText = list.length;
    const box = document.getElementById("z-evac-list");
    if(list.length === 0) { box.innerHTML = "<p class='col-span-full text-center text-emerald-400 font-bold p-4 bg-emerald-500/10 rounded-xl'>âœ… ØªÙ… Ø§Ù„Ø¥Ø®Ù„Ø§Ø¡ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>"; return; }
    box.innerHTML = list.map(w => `<div class="bg-white/5 p-3 rounded-xl border border-white/10 text-[10px] text-white flex justify-between"><span>${w}</span><span class="w-2 h-2 bg-turquoise rounded-full animate-pulse"></span></div>`).join("");
}

function switchZoneFilter(f) {
    currentZFilter = f;
    document.getElementById('btn-z-active').className = f==='active'?"flex-1 py-2 text-[11px] font-bold rounded-xl bg-purple-blue text-white shadow-lg":"flex-1 py-2 text-[11px] font-bold rounded-xl bg-white/5 text-gray-400";
    document.getElementById('btn-z-completed').className = f==='completed'?"flex-1 py-2 text-[11px] font-bold rounded-xl bg-purple-blue text-white shadow-lg":"flex-1 py-2 text-[11px] font-bold rounded-xl bg-white/5 text-gray-400";
    renderZones();
}

function markZoneSafe() { activeZone.status = 'completed'; closeZoneModal(); renderZones(); }
function closeZoneModal() { clearInterval(zInterval); document.getElementById("zoneModal").classList.add("hidden"); }

// --- Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø«Ø§Ù„Ø« ---
function loadRegionStats(reg) {
    const data = regions[reg];
    document.getElementById('reg-injuries').innerText = data.injuries;
    document.getElementById('reg-alerts').innerText = data.alerts;
    document.getElementById('reg-risk-val').innerText = data.risk + "%";
    document.getElementById('reg-risk-bar').style.width = data.risk + "%";
    document.getElementById('reg-ai-msg').innerHTML = data.ai;
}

// Ø§Ù„Ø¨Ø¯Ø¡
renderWorkers();
renderZones();
loadRegionStats('A');
</script>
</body>
</html>
